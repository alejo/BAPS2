<!--
 * Asterisk-GUI	-	an Asterisk configuration interface
 *
 * Manage network settings on the appliance
 *
 * Copyright (C) 2006-2007, Digium, Inc.
 *
 * Mark Spencer <markster@digium.com>
 * Pari Nannapaneni <pari@digium.com>
 * Brandon Kruse <bkruse@digium.com>
 *
 * See http://www.asterisk.org for more information about
 * the Asterisk project. Please do not directly contact
 * any of the maintainers of this project for assistance;
 * the project provides a web site, mailing lists and IRC
 * channels for your use.
 *
 * This program is free software, distributed under the terms of
 * the GNU General Public License Version 2. See the LICENSE file
 * at the top of the source tree.
-->
<script src="scripts/prototype.js"></script>
<script src="scripts/rico.js"></script>
<script src="scripts/astman.js"></script>
<link href="stylesheets/rico.css" media="all" rel="Stylesheet" type="text/css" />
<link href="stylesheets/schwing.css" media="all" rel="Stylesheet" type="text/css" />
<script>

var fieldnames = ['smtp_server' , 'smtp_port', 'save','cancel'] ;
var widgets = {};
var gpcallbacks = {};

gpcallbacks.format = function(t) {
	if ((t.name != 'general' ))
		return null;
	return t.name;
}

gpcallbacks.loaded = function() {
	_$('id_guipreferences').selectitem(0);
	parent.loadscreen(this);
}

gpcallbacks.savechanges = function(){
	// generate new /etc/ssmtp/ssmtp.conf (pending)
	if( !parseInt(_$('smtp_port').value, 10 ) ){
		var cmd1 = "echo \"mailhub=" + _$('smtp_server').value + ":25" + "\" > /etc/ssmtp/ssmtp.conf ";
	}else{
		var cmd1 = "echo \"mailhub=" + _$('smtp_server').value +":" + _$('smtp_port').value + "\" > /etc/ssmtp/ssmtp.conf ";
	}

	var cmd2 = "echo \"FromLineOverride=YES\" >> /etc/ssmtp/ssmtp.conf ";
	//var cmd3 = "echo \"hostname=" + hostname + "\" >> /etc/ssmtp/ssmtp.conf "; // from networking.conf

	parent.astmanEngine.run_tool(cmd1,onSuccess = function() { 
		parent.astmanEngine.run_tool(cmd2,onSuccess = function() { });
	});
}

function load_smtpsettings(){
	for (var x =0; x < fieldnames.length; x++ ) {
		widgets[fieldnames[x]] = _$(fieldnames[x]);
		widgets[fieldnames[x]].disabled = true;
	}
	parent.astmanEngine.config2list(asterisk_guiConfigFile , _$('id_guipreferences'), widgets, gpcallbacks);
}


function localajaxinit() {
	setWindowTitle("Network Settings");
	load_smtpsettings();
}

</script>
<body id="foo" onload="localajaxinit()"  bgcolor="EFEFEF">
<div class="mainscreenTitleBar">
	<span style="margin-left: 4px;font-weight:bold;"><A href="voicemail.html" style="cursor: pointer">Back</A></span>
</div>
<div class="mainscreenContentBox" id="mailboxcontent">
<table class="mainscreenTable" align="center">
	<tr>
	<td valign="top" align="center">
		<BR>
		<fieldset>
			<legend><B>&nbsp;SMTP Settings:&nbsp;</B></legend>
				<table>
				<tr>	<td align=right>Smtp server :</td>
					<td>&nbsp;<input id="smtp_server"></td>
				</tr>
				<tr>	<td align=right>Port :</td>
					<td>&nbsp;<input id="smtp_port"></td>
				</tr>
				<tr>	<td colspan=2 align="center">
					<div height="10"></div><BR>
					<input type="button" id="save" value="save">&nbsp;&nbsp;<input type="button" id="cancel" value="cancel">
					</td>
				</tr>
				</table>
		</fieldset>
	</td>
	</tr>
</table>
</div>
<select id="id_guipreferences" style="display:none"></select>
</body>